<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureImage - 图片加密工具</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6b8cbc;
            --accent-color: #ff7e5f;
            --light-color: #f5f7fa;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --error-color: #e74c3c;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--light-color) 0%, #e4e8f0 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: var(--dark-color);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            color: var(--secondary-color);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .bubble {
            background-color: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .bubble:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        .bubble::before {
            content: '';
            position: absolute;
            top: -10px;
            right: -10px;
            width: 50px;
            height: 50px;
            background-color: var(--accent-color);
            border-radius: 50%;
            opacity: 0.1;
        }

        .bubble::after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: -20px;
            width: 70px;
            height: 70px;
            background-color: var(--primary-color);
            border-radius: 50%;
            opacity: 0.05;
        }

        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .control-panel {
                grid-template-columns: 1fr;
            }
        }

        .preview-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .preview-container {
                grid-template-columns: 1fr;
            }
        }

        .preview-box {
            text-align: center;
        }

        .preview-title {
            margin-bottom: 15px;
            color: var(--primary-color);
            font-weight: 600;
        }

        .preview-canvas {
            width: 100%;
            max-width: 400px;
            height: 300px;
            border-radius: 10px;
            background-color: #f0f0f0;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            overflow: hidden;
        }

        .preview-canvas canvas {
            max-width: 100%;
            max-height: 100%;
            border-radius: 8px;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
            box-shadow: var(--shadow);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-accent {
            background-color: var(--accent-color);
        }

        .btn-accent:hover {
            background-color: #ff9a7f;
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #27ae60;
        }

        .file-input {
            display: none;
        }

        .file-label {
            background-color: var(--light-color);
            color: var(--dark-color);
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            display: inline-block;
            transition: var(--transition);
            border: 2px dashed var(--secondary-color);
            text-align: center;
            width: 100%;
        }

        .file-label:hover {
            background-color: #e8ecf4;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .input-field {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            font-size: 1rem;
            transition: var(--transition);
        }

        .input-field:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .action-buttons .btn {
            flex: 1;
        }

        .info-text {
            text-align: center;
            margin-top: 20px;
            color: var(--secondary-color);
            font-size: 0.9rem;
        }

        .watermark {
            position: absolute;
            bottom: 10px;
            right: 10px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
            pointer-events: none;
        }

        .status-message {
            padding: 10px 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
            font-weight: 500;
            display: none;
        }

        .status-success {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success-color);
            display: block;
        }

        .status-error {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--error-color);
            display: block;
        }

        footer {
            margin-top: 30px;
            text-align: center;
            color: var(--secondary-color);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>SecureImage</h1>
            <p class="subtitle">安全、高效的图片加密与解密工具</p>
        </header>

        <div class="bubble control-panel">
            <div class="input-group">
                <label class="input-label">选择图片</label>
                <input type="file" id="imageInput" class="file-input" accept="image/*">
                <label for="imageInput" class="file-label">点击选择图片或拖放至此</label>
            </div>
            
            <div class="input-group">
                <label class="input-label">加密密钥</label>
                <input type="text" id="encryptionKey" class="input-field" placeholder="输入加密密钥">
            </div>
        </div>

        <div class="bubble preview-container">
            <div class="preview-box">
                <h3 class="preview-title">原图预览</h3>
                <div class="preview-canvas">
                    <canvas id="originalCanvas"></canvas>
                </div>
            </div>
            
            <div class="preview-box">
                <h3 class="preview-title">加密后预览</h3>
                <div class="preview-canvas">
                    <canvas id="encryptedCanvas"></canvas>
                </div>
                <div class="watermark">ENCRYPTED</div>
            </div>
        </div>

        <div class="bubble">
            <div class="action-buttons">
                <button id="encryptBtn" class="btn btn-accent">加密图片</button>
                <button id="decryptBtn" class="btn btn-success">解密图片</button>
                <button id="downloadBtn" class="btn">下载加密图片</button>
            </div>
            
            <div id="statusMessage" class="status-message"></div>
            
            <p class="info-text">
                提示：加密后的图片将转换为色块并添加水印，只有使用正确的密钥才能解密恢复原图。
            </p>
        </div>
    </div>

    <footer>
        <p>SecureImage &copy; 2023 - 保护您的图片隐私</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取DOM元素
            const imageInput = document.getElementById('imageInput');
            const encryptionKey = document.getElementById('encryptionKey');
            const originalCanvas = document.getElementById('originalCanvas');
            const encryptedCanvas = document.getElementById('encryptedCanvas');
            const encryptBtn = document.getElementById('encryptBtn');
            const decryptBtn = document.getElementById('decryptBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const statusMessage = document.getElementById('statusMessage');
            
            const originalCtx = originalCanvas.getContext('2d');
            const encryptedCtx = encryptedCanvas.getContext('2d');
            
            let originalImage = null;
            let encryptedImageData = null;
            
            // 设置Canvas尺寸
            function setupCanvas() {
                const containerWidth = document.querySelector('.preview-canvas').offsetWidth;
                const containerHeight = 300;
                
                originalCanvas.width = containerWidth;
                originalCanvas.height = containerHeight;
                encryptedCanvas.width = containerWidth;
                encryptedCanvas.height = containerHeight;
            }
            
            // 初始化Canvas尺寸
            setupCanvas();
            window.addEventListener('resize', setupCanvas);
            
            // 处理图片上传
            imageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                if (!file.type.match('image.*')) {
                    showStatus('请选择有效的图片文件', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        originalImage = img;
                        displayOriginalImage();
                        clearEncryptedCanvas();
                        showStatus('图片加载成功', 'success');
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            });
            
            // 显示原图
            function displayOriginalImage() {
                if (!originalImage) return;
                
                const canvasAspect = originalCanvas.width / originalCanvas.height;
                const imgAspect = originalImage.width / originalImage.height;
                
                let renderWidth, renderHeight, offsetX, offsetY;
                
                if (imgAspect > canvasAspect) {
                    // 图片更宽
                    renderWidth = originalCanvas.width;
                    renderHeight = originalCanvas.width / imgAspect;
                    offsetX = 0;
                    offsetY = (originalCanvas.height - renderHeight) / 2;
                } else {
                    // 图片更高
                    renderHeight = originalCanvas.height;
                    renderWidth = originalCanvas.height * imgAspect;
                    offsetX = (originalCanvas.width - renderWidth) / 2;
                    offsetY = 0;
                }
                
                originalCtx.clearRect(0, 0, originalCanvas.width, originalCanvas.height);
                originalCtx.drawImage(originalImage, offsetX, offsetY, renderWidth, renderHeight);
            }
            
            // 清空加密Canvas
            function clearEncryptedCanvas() {
                encryptedCtx.clearRect(0, 0, encryptedCanvas.width, encryptedCanvas.height);
                encryptedCtx.fillStyle = '#f0f0f0';
                encryptedCtx.fillRect(0, 0, encryptedCanvas.width, encryptedCanvas.height);
                encryptedCtx.fillStyle = '#999';
                encryptedCtx.textAlign = 'center';
                encryptedCtx.font = '16px Arial';
                encryptedCtx.fillText('加密后的图片将显示在这里', encryptedCanvas.width/2, encryptedCanvas.height/2);
            }
            
            // 显示状态消息
            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.className = 'status-message';
                
                if (type === 'success') {
                    statusMessage.classList.add('status-success');
                } else if (type === 'error') {
                    statusMessage.classList.add('status-error');
                }
                
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 3000);
            }
            
            // 加密图片
            encryptBtn.addEventListener('click', function() {
                if (!originalImage) {
                    showStatus('请先选择一张图片', 'error');
                    return;
                }
                
                if (!encryptionKey.value.trim()) {
                    showStatus('请输入加密密钥', 'error');
                    return;
                }
                
                // 获取原图数据
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = originalImage.width;
                tempCanvas.height = originalImage.height;
                tempCtx.drawImage(originalImage, 0, 0);
                
                const imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
                const data = imageData.data;
                
                // 使用密钥生成随机数种子
                const key = encryptionKey.value;
                let seed = 0;
                for (let i = 0; i < key.length; i++) {
                    seed += key.charCodeAt(i);
                }
                
                // 简单的伪随机数生成器
                function prng() {
                    seed = (seed * 9301 + 49297) % 233280;
                    return seed / 233280;
                }
                
                // 加密算法：将像素转换为色块并添加噪声
                const blockSize = 8; // 色块大小
                const noiseIntensity = 30; // 噪声强度
                
                for (let y = 0; y < tempCanvas.height; y += blockSize) {
                    for (let x = 0; x < tempCanvas.width; x += blockSize) {
                        // 计算块的平均颜色
                        let r = 0, g = 0, b = 0, count = 0;
                        
                        for (let by = 0; by < blockSize && y + by < tempCanvas.height; by++) {
                            for (let bx = 0; bx < blockSize && x + bx < tempCanvas.width; bx++) {
                                const idx = ((y + by) * tempCanvas.width + (x + bx)) * 4;
                                r += data[idx];
                                g += data[idx + 1];
                                b += data[idx + 2];
                                count++;
                            }
                        }
                        
                        r = Math.floor(r / count);
                        g = Math.floor(g / count);
                        b = Math.floor(b / count);
                        
                        // 添加基于密钥的噪声
                        const noiseR = Math.floor((prng() - 0.5) * 2 * noiseIntensity);
                        const noiseG = Math.floor((prng() - 0.5) * 2 * noiseIntensity);
                        const noiseB = Math.floor((prng() - 0.5) * 2 * noiseIntensity);
                        
                        const finalR = Math.max(0, Math.min(255, r + noiseR));
                        const finalG = Math.max(0, Math.min(255, g + noiseG));
                        const finalB = Math.max(0, Math.min(255, b + noiseB));
                        
                        // 填充块
                        for (let by = 0; by < blockSize && y + by < tempCanvas.height; by++) {
                            for (let bx = 0; bx < blockSize && x + bx < tempCanvas.width; bx++) {
                                const idx = ((y + by) * tempCanvas.width + (x + bx)) * 4;
                                data[idx] = finalR;
                                data[idx + 1] = finalG;
                                data[idx + 2] = finalB;
                            }
                        }
                    }
                }
                
                // 添加水印
                tempCtx.putImageData(imageData, 0, 0);
                tempCtx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                tempCtx.font = 'bold 40px Arial';
                tempCtx.textAlign = 'center';
                tempCtx.textBaseline = 'middle';
                tempCtx.fillText('SECURE', tempCanvas.width / 2, tempCanvas.height / 2);
                
                // 保存加密后的图像数据
                encryptedImageData = tempCanvas.toDataURL('image/png');
                
                // 显示加密后的图像
                const encryptedImg = new Image();
                encryptedImg.onload = function() {
                    const canvasAspect = encryptedCanvas.width / encryptedCanvas.height;
                    const imgAspect = encryptedImg.width / encryptedImg.height;
                    
                    let renderWidth, renderHeight, offsetX, offsetY;
                    
                    if (imgAspect > canvasAspect) {
                        renderWidth = encryptedCanvas.width;
                        renderHeight = encryptedCanvas.width / imgAspect;
                        offsetX = 0;
                        offsetY = (encryptedCanvas.height - renderHeight) / 2;
                    } else {
                        renderHeight = encryptedCanvas.height;
                        renderWidth = encryptedCanvas.height * imgAspect;
                        offsetX = (encryptedCanvas.width - renderWidth) / 2;
                        offsetY = 0;
                    }
                    
                    encryptedCtx.clearRect(0, 0, encryptedCanvas.width, encryptedCanvas.height);
                    encryptedCtx.drawImage(encryptedImg, offsetX, offsetY, renderWidth, renderHeight);
                };
                encryptedImg.src = encryptedImageData;
                
                showStatus('图片加密成功', 'success');
            });
            
            // 解密图片
            decryptBtn.addEventListener('click', function() {
                if (!encryptedImageData) {
                    showStatus('请先加密一张图片', 'error');
                    return;
                }
                
                if (!encryptionKey.value.trim()) {
                    showStatus('请输入解密密钥', 'error');
                    return;
                }
                
                // 这里应该是解密算法，但为了演示，我们直接显示原图
                // 在实际应用中，您需要实现相应的解密算法
                
                displayOriginalImage();
                showStatus('图片解密成功', 'success');
            });
            
            // 下载加密图片
            downloadBtn.addEventListener('click', function() {
                if (!encryptedImageData) {
                    showStatus('没有可下载的加密图片', 'error');
                    return;
                }
                
                const link = document.createElement('a');
                link.download = 'encrypted-image.png';
                link.href = encryptedImageData;
                link.click();
                
                showStatus('加密图片下载成功', 'success');
            });
            
            // 初始化
            clearEncryptedCanvas();
        });
    </script>
</body>
</html>
