<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å›¾ç‰‡åŠ å¯†è§£å¯† Â· ç»¿è‰²æ°”æ³¡ UI</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <style>
    /* ============ å…¨å±€åŸºç¡€ ============ */
    :root {
      --bg: #02130b;
      --bg-soft: rgba(5, 46, 22, 0.9);
      --bubble: rgba(16, 185, 129, 0.16);
      --bubble-strong: rgba(16, 185, 129, 0.25);
      --bubble-outline: rgba(110, 231, 183, 0.45);
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.2);
      --accent-strong: #4ade80;
      --danger: #f97373;
      --text-main: #ecfdf3;
      --text-soft: #9ca3af;
      --radius-xl: 24px;
      --radius-full: 999px;
      --shadow-soft: 0 18px 45px rgba(6, 95, 70, 0.5);
      --transition-fast: 0.18s ease-out;
      --transition-slow: 0.28s cubic-bezier(.22,.61,.36,1);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro SC",
        "PingFang SC", "Microsoft YaHei", sans-serif;
      background:
        radial-gradient(circle at 0% 0%, rgba(74, 222, 128, 0.15), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(52, 211, 153, 0.18), transparent 55%),
        radial-gradient(circle at 0% 100%, rgba(22, 163, 74, 0.18), transparent 50%),
        radial-gradient(circle at 100% 0%, rgba(21, 128, 61, 0.25), transparent 55%),
        var(--bg);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px;
    }

    /* ============ å¤–å±‚å®¹å™¨ / å“åº”å¼ ============ */
    .shell {
      width: 100%;
      max-width: 1160px;
      border-radius: 32px;
      background: linear-gradient(145deg, rgba(6, 78, 59, 0.92), rgba(2, 44, 34, 0.96));
      box-shadow: var(--shadow-soft);
      padding: 18px;
      border: 1px solid rgba(52, 211, 153, 0.35);
      display: flex;
      flex-direction: column;
      gap: 14px;
      backdrop-filter: blur(28px) saturate(150%);
    }

    @media (min-width: 900px) {
      .shell {
        padding: 20px 22px 24px;
      }
    }

    .shell-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 2px 6px 4px;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title-row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 7px;
      padding: 4px 11px;
      border-radius: var(--radius-full);
      background: radial-gradient(circle at 0 0, rgba(34, 197, 94, 0.35), rgba(22, 101, 52, 0.1));
      border: 1px solid rgba(45, 212, 191, 0.7);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #bbf7d0;
    }

    .chip-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: conic-gradient(from 180deg, #22c55e, #4ade80, #a7f3d0, #22c55e);
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.18);
    }

    .title-main {
      font-size: 19px;
      font-weight: 650;
      letter-spacing: 0.03em;
      display: inline-flex;
      align-items: baseline;
      gap: 6px;
    }

    .title-main span.accent {
      color: var(--accent-strong);
      text-shadow: 0 0 18px rgba(34, 197, 94, 0.7);
    }

    .subtitle {
      font-size: 12px;
      color: var(--text-soft);
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .subtitle-pill {
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15, 118, 110, 0.55);
      color: #a5f3fc;
      font-size: 11px;
      border: 1px solid rgba(45, 212, 191, 0.4);
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .status-pill {
      font-size: 11px;
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(15, 118, 110, 0.7);
      color: #a5f3fc;
      border: 1px solid rgba(56, 189, 248, 0.5);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: radial-gradient(circle, #22c55e 0, #166534 38%, transparent 70%);
      box-shadow: 0 0 14px rgba(22, 163, 74, 0.8);
    }

    /* ============ ä¸»å¸ƒå±€ ============ */
    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 2fr);
      gap: 14px;
      align-items: stretch;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    /* ============ å·¦ä¾§ï¼šæ§åˆ¶ä¸ä¿¡æ¯ ============ */
    .panel {
      border-radius: 26px;
      background: radial-gradient(circle at 0 -40%, rgba(45, 212, 191, 0.3), transparent 60%),
        radial-gradient(circle at 100% 120%, rgba(22, 163, 74, 0.45), transparent 60%),
        rgba(2, 44, 34, 0.95);
      border: 1px solid rgba(34, 197, 94, 0.4);
      padding: 14px 14px 12px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: -60%;
      background-image:
        radial-gradient(circle at 0 0, rgba(45, 212, 191, 0.16), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(22, 163, 74, 0.18), transparent 55%);
      opacity: 0.6;
      mix-blend-mode: soft-light;
      pointer-events: none;
    }

    .panel-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .section-title span {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .badge {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(52, 211, 153, 0.65);
      background: rgba(6, 78, 59, 0.8);
      color: #bbf7d0;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .hint-text {
      font-size: 11px;
      color: var(--text-soft);
      line-height: 1.6;
    }

    /* ============ ä¸Šä¼ åŒº / æ°”æ³¡æ ·å¼ ============ */
    .upload-bubble {
      position: relative;
      border-radius: 24px;
      background:
        radial-gradient(circle at 0 0, rgba(110, 231, 183, 0.28), rgba(22, 101, 52, 0.2)),
        radial-gradient(circle at 100% 100%, rgba(59, 130, 246, 0.04), rgba(6, 78, 59, 0.85));
      border: 1px solid rgba(45, 212, 191, 0.8);
      padding: 10px 11px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      cursor: pointer;
      overflow: hidden;
      box-shadow: 0 12px 30px rgba(15, 118, 110, 0.6);
      transition: transform var(--transition-slow), box-shadow var(--transition-fast),
        border-color var(--transition-fast), background var(--transition-slow);
    }

    .upload-bubble::after {
      content: "";
      position: absolute;
      inset: 30% -40px auto auto;
      height: 140%;
      background: radial-gradient(circle at 0 0, rgba(187, 247, 208, 0.4), transparent 60%);
      opacity: 0;
      transform: translate3d(0, 12px, 0);
      transition: opacity 0.25s ease-out, transform 0.25s ease-out;
      pointer-events: none;
    }

    .upload-bubble:hover {
      transform: translateY(-3px);
      box-shadow: 0 18px 40px rgba(22, 163, 74, 0.75);
      border-color: rgba(74, 222, 128, 0.95);
    }

    .upload-bubble:hover::after {
      opacity: 1;
      transform: translate3d(0, 0, 0);
    }

    .upload-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .upload-main-label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      font-weight: 500;
    }

    .icon-circle {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 30% 20%, #bbf7d0, #4ade80 45%, #166534 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #052e16;
      font-size: 15px;
      box-shadow: 0 0 16px rgba(34, 197, 94, 0.8);
    }

    .upload-sub {
      font-size: 11px;
      color: rgba(240, 253, 244, 0.9);
    }

    .upload-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 11px;
      color: #bbf7d0;
    }

    .upload-meta span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(6, 95, 70, 0.7);
      border: 1px solid rgba(45, 212, 191, 0.55);
    }

    .upload-meta-dot {
      width: 5px;
      height: 5px;
      border-radius: 999px;
      background: #a7f3d0;
    }

    .upload-input {
      display: none;
    }

    /* ============ æ»‘å— / æ§åˆ¶æ¡ ============ */
    .control-group {
      border-radius: 18px;
      background: linear-gradient(135deg, rgba(2, 44, 34, 0.96), rgba(5, 46, 22, 0.98));
      border: 1px solid rgba(34, 197, 94, 0.6);
      padding: 9px 10px 8px;
      display: flex;
      flex-direction: column;
      gap: 9px;
    }

    .control-row {
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) minmax(0, 1.7fr);
      gap: 9px;
    }

    @media (max-width: 640px) {
      .control-row {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .control-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .control-label-line {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      font-size: 11px;
      color: #d1fae5;
    }

    .control-label-line span.key {
      font-weight: 500;
    }

    .control-label-line span.value {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono",
        "Courier New", monospace;
      background: rgba(6, 78, 59, 0.9);
      padding: 1px 7px;
      border-radius: 999px;
      font-size: 10px;
      border: 1px solid rgba(52, 211, 153, 0.6);
      color: #bbf7d0;
    }

    .slider-shell {
      height: 24px;
      border-radius: 999px;
      background: radial-gradient(circle at 0 0, rgba(52, 211, 153, 0.22), rgba(2, 44, 34, 0.95));
      padding: 0 7px;
      display: flex;
      align-items: center;
      position: relative;
      overflow: hidden;
    }

    .slider-shell::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(
        90deg,
        rgba(16, 185, 129, 0.15),
        rgba(52, 211, 153, 0.4),
        rgba(16, 185, 129, 0.12)
      );
      opacity: 0.45;
      pointer-events: none;
    }

    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      background: transparent;
      position: relative;
      z-index: 1;
    }

    input[type="range"]::-webkit-slider-runnable-track {
      height: 3px;
      background: radial-gradient(circle at 0 0, rgba(16, 185, 129, 0.8), rgba(6, 78, 59, 0.95));
      border-radius: 999px;
    }

    input[type="range"]::-moz-range-track {
      height: 3px;
      background: radial-gradient(circle at 0 0, rgba(16, 185, 129, 0.8), rgba(6, 78, 59, 0.95));
      border-radius: 999px;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      margin-top: -6px;
      background:
        radial-gradient(circle at 30% 20%, #bbf7d0, #4ade80 40%, #16a34a 100%);
      box-shadow:
        0 0 0 4px rgba(34, 197, 94, 0.35),
        0 10px 20px rgba(22, 163, 74, 0.7);
      border: 1px solid rgba(226, 232, 240, 0.8);
      cursor: pointer;
    }

    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background:
        radial-gradient(circle at 30% 20%, #bbf7d0, #4ade80 40%, #16a34a 100%);
      box-shadow:
        0 0 0 4px rgba(34, 197, 94, 0.35),
        0 10px 20px rgba(22, 163, 74, 0.7);
      border: 1px solid rgba(226, 232, 240, 0.8);
      cursor: pointer;
    }

    /* ============ æŒ‰é’®ç»„ ============ */
    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      justify-content: space-between;
      margin-top: 4px;
    }

    .button-group-main {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .btn {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 6px 13px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 500;
      border: 1px solid transparent;
      background: transparent;
      color: #e5fdf4;
      cursor: pointer;
      transition: transform var(--transition-fast),
        box-shadow var(--transition-fast),
        background var(--transition-fast),
        border-color var(--transition-fast),
        color var(--transition-fast);
      white-space: nowrap;
    }

    .btn-primary {
      background: radial-gradient(circle at 0 0, #bbf7d0, #22c55e 38%, #166534 100%);
      border-color: rgba(187, 247, 208, 0.95);
      color: #022c22;
      box-shadow: 0 10px 26px rgba(34, 197, 94, 0.85);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-1.5px);
      box-shadow: 0 14px 34px rgba(34, 197, 94, 0.9);
    }

    .btn-secondary {
      padding-inline: 10px;
      background: rgba(6, 95, 70, 0.86);
      border-color: rgba(52, 211, 153, 0.7);
      color: #a7f3d0;
      box-shadow: 0 6px 16px rgba(15, 118, 110, 0.85);
    }

    .btn-secondary:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(15, 118, 110, 0.9);
      background: rgba(5, 150, 105, 0.95);
    }

    .btn-icon {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      border: 1px solid rgba(52, 211, 153, 0.6);
      background: rgba(6, 78, 59, 0.9);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      color: #a7f3d0;
    }

    .btn:disabled {
      cursor: not-allowed;
      opacity: 0.6;
      box-shadow: none;
      transform: none;
    }

    .inline-indicator {
      font-size: 10px;
      color: rgba(209, 250, 229, 0.8);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .inline-indicator-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: radial-gradient(circle, #22c55e 0, #15803d 60%, transparent 80%);
      box-shadow: 0 0 10px rgba(22, 163, 74, 0.9);
    }

    /* ============ å³ä¾§ï¼šé¢„è§ˆç½‘æ ¼ ============ */
    .preview-panel {
      border-radius: 26px;
      background:
        radial-gradient(circle at 0 0, rgba(16, 185, 129, 0.32), rgba(2, 44, 34, 0.98)),
        radial-gradient(circle at 100% 100%, rgba(22, 163, 74, 0.32), rgba(2, 6, 23, 0.96));
      border: 1px solid rgba(52, 211, 153, 0.55);
      padding: 12px 12px 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: relative;
      overflow: hidden;
    }

    .preview-panel::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0 0, rgba(34, 197, 94, 0.22), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(45, 212, 191, 0.2), transparent 60%);
      mix-blend-mode: soft-light;
      opacity: 0.7;
      pointer-events: none;
    }

    .preview-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .preview-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
    }

    @media (max-width: 900px) {
      .preview-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .preview-cell:nth-child(3) {
        grid-column: span 2;
      }
    }

    @media (max-width: 640px) {
      .preview-grid {
        grid-template-columns: minmax(0, 1fr);
      }

      .preview-cell:nth-child(3) {
        grid-column: auto;
      }
    }

    .preview-cell {
      position: relative;
      border-radius: 20px;
      background: radial-gradient(circle at 0 0, rgba(16, 185, 129, 0.22), rgba(6, 78, 59, 0.92));
      border: 1px solid rgba(45, 212, 191, 0.7);
      padding: 8px 8px 7px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      overflow: hidden;
      box-shadow: 0 12px 30px rgba(15, 118, 110, 0.7);
    }

    .preview-label-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .preview-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: #bbf7d0;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .preview-label-pill {
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(6, 95, 70, 0.9);
      border: 1px solid rgba(52, 211, 153, 0.75);
      font-size: 10px;
      color: #a7f3d0;
    }

    .preview-meta {
      font-size: 10px;
      color: #a7f3d0;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: flex-end;
    }

    .preview-meta span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    .preview-meta-dot {
      width: 4px;
      height: 4px;
      border-radius: 999px;
      background: #a7f3d0;
    }

    .preview-canvas-shell {
      position: relative;
      border-radius: 14px;
      background:
        radial-gradient(circle at 0 0, rgba(34, 197, 94, 0.24), rgba(15, 23, 42, 0.98));
      border: 1px solid rgba(45, 212, 191, 0.6);
      overflow: hidden;
      min-height: 160px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .preview-canvas-shell canvas {
      max-width: 100%;
      height: auto;
      display: block;
    }

    .preview-placeholder {
      font-size: 11px;
      color: #9ca3af;
      text-align: center;
      padding: 18px 10px;
    }

    .preview-fx {
      position: absolute;
      inset: 0;
      pointer-events: none;
      mix-blend-mode: screen;
      opacity: 0.28;
      background-image:
        radial-gradient(circle at 0 0, rgba(59, 130, 246, 0.7), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(34, 197, 94, 0.7), transparent 55%);
    }

    /* ============ åº•éƒ¨çŠ¶æ€æ  ============ */
    .footer-bar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 4px 3px 0;
      border-top: 1px dashed rgba(55, 65, 81, 0.9);
      font-size: 11px;
      color: var(--text-soft);
    }

    .footer-left,
    .footer-right {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .footer-tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 1px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: #e5e7eb;
    }

    .footer-tag span {
      font-size: 10px;
      color: #9ca3af;
    }

    .status-text {
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .status-text strong {
      font-weight: 500;
      color: #d1fae5;
    }

    .status-chip-ok {
      color: #bbf7d0;
    }

    .status-chip-warn {
      color: #fed7aa;
    }

    .status-chip-err {
      color: #fecaca;
    }

    /* ç®€å•çš„æ·¡å…¥åŠ¨ç”» */
    .fade-in {
      animation: fadeIn 0.25s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(4px) scale(0.99);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
  </style>
</head>
<body>
  <div class="shell">
    <!-- é¡¶éƒ¨æ ‡é¢˜åŒº -->
    <header class="shell-header">
      <div class="title-block">
        <div class="title-row">
          <div class="chip">
            <span class="chip-dot"></span>
            BUBBLE IMAGE CRYPTO
          </div>
          <div class="title-main">
            æ°”æ³¡å›¾ç‰‡
            <span class="accent">åŠ å¯† Â· è§£å¯†</span>
          </div>
        </div>
        <div class="subtitle">
          <span>å“åº”å¼ Â· ç»¿è‰²ä¸»é¢˜ Â· åŸå›¾ / åŠ å¯† / è§£å¯† ä¸‰é¢„è§ˆ</span>
          <span class="subtitle-pill">ä¸“ä¸ºå¯ç»´æŠ¤åº•å±‚ä»£ç è®¾è®¡</span>
        </div>
      </div>
      <div class="header-actions">
        <div class="status-pill">
          <span class="status-dot"></span>
          å®æ—¶é¢„è§ˆå¯ç”¨
        </div>
      </div>
    </header>

    <main class="layout">
      <!-- å·¦ä¾§ï¼šæ§åˆ¶åŒº -->
      <section class="panel">
        <div class="panel-inner">
          <div class="section-title">
            <span>
              ä¸Šä¼ å›¾ç‰‡
              <small style="font-size:11px;color:var(--text-soft);">æ”¯æŒ PNG / JPG / WebP</small>
            </span>
            <span class="badge">STEP Â· 01</span>
          </div>

          <!-- ä¸Šä¼ æ°”æ³¡ -->
          <label class="upload-bubble">
            <div class="upload-header">
              <div class="upload-main-label">
                <div class="icon-circle">ï¼‹</div>
                <div>
                  <div>ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</div>
                  <div class="upload-sub">ä¸ä¸Šä¼ åˆ°æœåŠ¡å™¨ Â· å…¨ç¨‹æœ¬åœ°åŠ å¯†è§£å¯†</div>
                </div>
              </div>
            </div>
            <div class="upload-meta">
              <span>
                <span class="upload-meta-dot"></span>
                æœ€å¤§æ¨è 8K åˆ†è¾¨ç‡
              </span>
              <span>
                <span class="upload-meta-dot"></span>
                è‡ªåŠ¨é€‚é…é¢„è§ˆåŒºåŸŸ
              </span>
            </div>
            <input
              class="upload-input"
              id="fileInput"
              type="file"
              accept="image/*"
            />
          </label>

          <!-- æ§åˆ¶å‚æ•° -->
          <div class="section-title">
            <span>åŠ å¯†å‚æ•°</span>
            <span class="badge">STEP Â· 02</span>
          </div>
          <p class="hint-text">
            åŠ å¯†å¼ºåº¦è¶Šé«˜ï¼Œåƒç´ æ‰°åŠ¨è¶Šæ˜æ˜¾ï¼Œå®‰å…¨æ€§æ›´é«˜ä½†è‚‰çœ¼å·®å¼‚ä¹Ÿä¼šç¨å¤§ï¼›è¾“å‡ºè´¨é‡è¶Šé«˜ï¼Œæ–‡ä»¶è¶Šå¤§ä½†ç»†èŠ‚ä¿ç•™æ›´å¤šã€‚å¯æ ¹æ®é¡¹ç›®éœ€æ±‚è‡ªç”±æƒè¡¡ã€‚
          </p>

          <div class="control-group">
            <div class="control-row">
              <div class="control-item">
                <div class="control-label-line">
                  <span class="key">åŠ å¯†å¼ºåº¦</span>
                  <span class="value" id="noiseValueLabel">ä¸­ç­‰ Â· 4</span>
                </div>
                <div class="slider-shell">
                  <input
                    id="noiseSlider"
                    type="range"
                    min="0"
                    max="8"
                    step="1"
                    value="4"
                  />
                </div>
              </div>

              <div class="control-item">
                <div class="control-label-line">
                  <span class="key">è¾“å‡ºè´¨é‡ (å‹ç¼©)</span>
                  <span class="value" id="qualityValueLabel">90%</span>
                </div>
                <div class="slider-shell">
                  <input
                    id="qualitySlider"
                    type="range"
                    min="40"
                    max="100"
                    step="5"
                    value="90"
                  />
                </div>
              </div>
            </div>

            <div class="control-row">
              <div class="control-item">
                <div class="control-label-line">
                  <span class="key">åŠ å¯†å¯†é’¥ (å¯é€‰)</span>
                  <span class="value" id="keyHashPreview">è‡ªåŠ¨éšæœº</span>
                </div>
                <div class="slider-shell" style="padding:0 8px;height:28px;">
                  <input
                    id="keyInput"
                    type="text"
                    placeholder="ç•™ç©ºåˆ™è‡ªåŠ¨ç”Ÿæˆå®‰å…¨éšæœºå¯†é’¥"
                    style="
                      width:100%;
                      border:none;
                      outline:none;
                      background:transparent;
                      color:#e5fdf4;
                      font-size:11px;
                    "
                  />
                </div>
              </div>

              <div class="control-item">
                <div class="control-label-line">
                  <span class="key">æ¨¡å¼</span>
                  <span class="value" id="modeLabel">å¾…é€‰æ‹©</span>
                </div>
                <div class="slider-shell" style="justify-content:space-between;padding:2px 3px;">
                  <button type="button" class="btn btn-secondary" id="encryptModeBtn">
                    <span class="btn-icon">ğŸ”</span> åŠ å¯†
                  </button>
                  <button type="button" class="btn btn-secondary" id="decryptModeBtn">
                    <span class="btn-icon">ğŸ”“</span> è§£å¯†
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- æ“ä½œæŒ‰é’® -->
          <div class="section-title">
            <span>æ“ä½œ</span>
            <span class="badge">STEP Â· 03</span>
          </div>
          <div class="button-row">
            <div class="button-group-main">
              <button type="button" class="btn btn-primary" id="runEncryptBtn">
                <span class="btn-icon">âš™</span>
                è¿è¡ŒåŠ å¯† / è§£å¯†
              </button>
              <button type="button" class="btn btn-secondary" id="exportEncryptedBtn" disabled>
                å¯¼å‡ºåŠ å¯†å›¾ç‰‡
              </button>
              <button type="button" class="btn btn-secondary" id="exportDecryptedBtn" disabled>
                å¯¼å‡ºè§£å¯†å›¾ç‰‡
              </button>
            </div>
            <span class="inline-indicator" id="inlineIndicator">
              <span class="inline-indicator-dot"></span>
              ç­‰å¾…å›¾ç‰‡ä¸Šä¼ â€¦
            </span>
          </div>
        </div>
      </section>

      <!-- å³ä¾§ï¼šé¢„è§ˆåŒº -->
      <section class="preview-panel">
        <div class="preview-inner">
          <div class="section-title">
            <span>ä¸‰è·¯é¢„è§ˆ Â· åŸå›¾ / åŠ å¯† / è§£å¯†</span>
            <span class="badge">LIVE</span>
          </div>

          <div class="preview-grid">
            <!-- åŸå›¾ -->
            <div class="preview-cell">
              <div class="preview-label-row">
                <div class="preview-label">
                  <span>åŸå§‹å›¾ç‰‡</span>
                  <span class="preview-label-pill">INPUT</span>
                </div>
                <div class="preview-meta" id="origMeta">
                  <span><span class="preview-meta-dot"></span>æ— å›¾ç‰‡</span>
                </div>
              </div>
              <div class="preview-canvas-shell">
                <canvas id="origCanvas"></canvas>
                <div class="preview-placeholder" id="origPlaceholder">
                  ä¸Šä¼ ä¸€å¼ å›¾ç‰‡åï¼Œè¿™é‡Œä¼šå±•ç¤ºåŸå›¾ã€‚
                </div>
              </div>
            </div>

            <!-- åŠ å¯† -->
            <div class="preview-cell">
              <div class="preview-label-row">
                <div class="preview-label">
                  <span>åŠ å¯†ç»“æœ</span>
                  <span class="preview-label-pill">ENCRYPTED</span>
                </div>
                <div class="preview-meta" id="encryptedMeta">
                  <span><span class="preview-meta-dot"></span>ç­‰å¾…ç”Ÿæˆ</span>
                </div>
              </div>
              <div class="preview-canvas-shell">
                <canvas id="encryptedCanvas"></canvas>
                <div class="preview-placeholder" id="encryptedPlaceholder">
                  ç‚¹å‡»â€œè¿è¡ŒåŠ å¯†â€åï¼Œè¿™é‡Œä¼šå±•ç¤ºåŠ å¯†åçš„å›¾ç‰‡ã€‚
                </div>
                <div class="preview-fx"></div>
              </div>
            </div>

            <!-- è§£å¯† -->
            <div class="preview-cell">
              <div class="preview-label-row">
                <div class="preview-label">
                  <span>è§£å¯†ç»“æœ</span>
                  <span class="preview-label-pill">DECRYPTED</span>
                </div>
                <div class="preview-meta" id="decryptedMeta">
                  <span><span class="preview-meta-dot"></span>ç­‰å¾…ç”Ÿæˆ</span>
                </div>
              </div>
              <div class="preview-canvas-shell">
                <canvas id="decryptedCanvas"></canvas>
                <div class="preview-placeholder" id="decryptedPlaceholder">
                  å¦‚æœå½“å‰å›¾ç‰‡å·²åŠ å¯†ä¸”å‚æ•°æ­£ç¡®ï¼Œè¿™é‡Œä¼šè¿˜åŸå‡ºæ¥è¿‘åŸå§‹çš„å›¾åƒã€‚
                </div>
                <div class="preview-fx"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- åº•éƒ¨çŠ¶æ€æ  -->
        <footer class="footer-bar">
          <div class="footer-left">
            <div class="footer-tag">
              åº•å±‚ç®—æ³•
              <span>å¯é€†åƒç´ æ‰°åŠ¨ Â· è´¨é‡å¯è°ƒ</span>
            </div>
            <div class="footer-tag">
              è®¾è®¡ç›®æ ‡
              <span>å¥½ä¿® Â· ä¸â€œç‰µä¸€å‘åŠ¨å…¨èº«â€</span>
            </div>
          </div>
          <div class="footer-right">
            <div class="status-text" id="statusText">
              <span class="status-chip-warn">çŠ¶æ€ï¼š</span>
              <span>ç­‰å¾…ä½ é€‰æ‹©æ¨¡å¼å¹¶ä¸Šä¼ å›¾ç‰‡</span>
            </div>
          </div>
        </footer>
      </section>
    </main>
  </div>

  <script>
    // ============ å·¥å…·ï¼šç®€æ˜“ä¼ªéšæœºæ•° / å“ˆå¸Œ ============
    function stringToSeed(str) {
      // FNV-1a ç®€æ˜“å®ç°ï¼Œç¨³å®šå¯å¤ç°
      let hash = 0x811c9dc5;
      for (let i = 0; i < str.length; i++) {
        hash ^= str.charCodeAt(i);
        hash = (hash * 0x01000193) >>> 0;
      }
      return hash >>> 0;
    }

    function seededRandom(seed) {
      // xorshift32
      let x = seed || 123456789;
      return function () {
        x ^= x << 13;
        x ^= x >>> 17;
        x ^= x << 5;
        x >>>= 0;
        return x / 0xffffffff;
      };
    }

    function shortHash(str) {
      const seed = stringToSeed(str);
      return (seed >>> 0).toString(16).padStart(8, "0");
    }

    // ============ DOM å¼•ç”¨ ============
    const fileInput = document.getElementById("fileInput");

    const noiseSlider = document.getElementById("noiseSlider");
    const qualitySlider = document.getElementById("qualitySlider");
    const noiseValueLabel = document.getElementById("noiseValueLabel");
    const qualityValueLabel = document.getElementById("qualityValueLabel");
    const keyInput = document.getElementById("keyInput");
    const keyHashPreview = document.getElementById("keyHashPreview");

    const encryptModeBtn = document.getElementById("encryptModeBtn");
    const decryptModeBtn = document.getElementById("decryptModeBtn");
    const modeLabel = document.getElementById("modeLabel");

    const runEncryptBtn = document.getElementById("runEncryptBtn");
    const exportEncryptedBtn = document.getElementById("exportEncryptedBtn");
    const exportDecryptedBtn = document.getElementById("exportDecryptedBtn");

    const inlineIndicator = document.getElementById("inlineIndicator");
    const statusText = document.getElementById("statusText");

    const origCanvas = document.getElementById("origCanvas");
    const encryptedCanvas = document.getElementById("encryptedCanvas");
    const decryptedCanvas = document.getElementById("decryptedCanvas");

    const origMeta = document.getElementById("origMeta");
    const encryptedMeta = document.getElementById("encryptedMeta");
    const decryptedMeta = document.getElementById("decryptedMeta");

    const origPlaceholder = document.getElementById("origPlaceholder");
    const encryptedPlaceholder = document.getElementById("encryptedPlaceholder");
    const decryptedPlaceholder = document.getElementById("decryptedPlaceholder");

    const origCtx = origCanvas.getContext("2d");
    const encCtx = encryptedCanvas.getContext("2d");
    const decCtx = decryptedCanvas.getContext("2d");

    // ============ çŠ¶æ€å˜é‡ ============
    const state = {
      mode: null, // "encrypt" | "decrypt"
      originalImage: null,
      originalSize: null,
      encryptedImageData: null,
      encryptedSize: null,
      decryptedImageData: null,
      decryptedSize: null,
      currentKey: null,
      currentSeed: null,
    };

    // ============ UI è¾…åŠ©å‡½æ•° ============
    function setStatus(message, type = "info") {
      const map = {
        info: "status-chip-ok",
        warn: "status-chip-warn",
        error: "status-chip-err",
      };
      statusText.innerHTML = `
        <span class="${map[type]}">çŠ¶æ€ï¼š</span>
        <span>${message}</span>
      `;
    }

    function setInlineIndicator(message) {
      inlineIndicator.innerHTML = `
        <span class="inline-indicator-dot"></span>
        ${message}
      `;
    }

    function setMode(mode) {
      state.mode = mode;
      if (mode === "encrypt") {
        modeLabel.textContent = "åŠ å¯†æ¨¡å¼";
        encryptModeBtn.classList.add("btn-primary");
        encryptModeBtn.classList.remove("btn-secondary");
        decryptModeBtn.classList.add("btn-secondary");
        decryptModeBtn.classList.remove("btn-primary");
        setStatus("åŠ å¯†æ¨¡å¼å·²å¼€å¯ï¼Œä¸Šä¼ æˆ–é€‰æ‹©éœ€è¦åŠ å¯†çš„å›¾ç‰‡ã€‚", "info");
      } else if (mode === "decrypt") {
        modeLabel.textContent = "è§£å¯†æ¨¡å¼";
        decryptModeBtn.classList.add("btn-primary");
        decryptModeBtn.classList.remove("btn-secondary");
        encryptModeBtn.classList.add("btn-secondary");
        encryptModeBtn.classList.remove("btn-primary");
        setStatus("è§£å¯†æ¨¡å¼å·²å¼€å¯ï¼Œè¯·ç¡®ä¿å‚æ•°ä¸åŠ å¯†æ—¶ä¸€è‡´ã€‚", "info");
      } else {
        modeLabel.textContent = "å¾…é€‰æ‹©";
        encryptModeBtn.classList.add("btn-secondary");
        decryptModeBtn.classList.add("btn-secondary");
      }
    }

    function formatBytes(bytes) {
      if (!bytes && bytes !== 0) return "æœªçŸ¥";
      const sizes = ["B", "KB", "MB", "GB"];
      const i = bytes === 0 ? 0 : Math.floor(Math.log(bytes) / Math.log(1024));
      const v = (bytes / Math.pow(1024, i)).toFixed(i === 0 ? 0 : 2);
      return `${v} ${sizes[i]}`;
    }

    function updateMeta() {
      if (state.originalImage) {
        const w = state.originalImage.naturalWidth;
        const h = state.originalImage.naturalHeight;
        const s = state.originalSize;
        origMeta.innerHTML = `
          <span><span class="preview-meta-dot"></span>${w} Ã— ${h}</span>
          <span><span class="preview-meta-dot"></span>${s ? formatBytes(s) : "æœ¬åœ°"}</span>
        `;
      } else {
        origMeta.innerHTML = `<span><span class="preview-meta-dot"></span>æ— å›¾ç‰‡</span>`;
      }

      if (state.encryptedImageData) {
        const w = encryptedCanvas.width;
        const h = encryptedCanvas.height;
        const s = state.encryptedSize;
        encryptedMeta.innerHTML = `
          <span><span class="preview-meta-dot"></span>${w} Ã— ${h}</span>
          <span><span class="preview-meta-dot"></span>${s ? formatBytes(s) : "æœ¬åœ°"}</span>
        `;
      } else {
        encryptedMeta.innerHTML = `<span><span class="preview-meta-dot"></span>ç­‰å¾…ç”Ÿæˆ</span>`;
      }

      if (state.decryptedImageData) {
        const w = decryptedCanvas.width;
        const h = decryptedCanvas.height;
        const s = state.decryptedSize;
        decryptedMeta.innerHTML = `
          <span><span class="preview-meta-dot"></span>${w} Ã— ${h}</span>
          <span><span class="preview-meta-dot"></span>${s ? formatBytes(s) : "æœ¬åœ°"}</span>
        `;
      } else {
        decryptedMeta.innerHTML = `<span><span class="preview-meta-dot"></span>ç­‰å¾…ç”Ÿæˆ</span>`;
      }
    }

    function resizeCanvasToImage(canvas, img, maxWidth = 900, maxHeight = 600) {
      let w = img.naturalWidth;
      let h = img.naturalHeight;
      const ratio = Math.min(maxWidth / w, maxHeight / h, 1);
      w = Math.round(w * ratio);
      h = Math.round(h * ratio);
      canvas.width = w;
      canvas.height = h;
      return { w, h };
    }

    function drawPlaceholderClear(canvas, placeholderEl, visible) {
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      placeholderEl.style.display = visible ? "block" : "none";
    }

    // ============ æ»‘å— / å¯†é’¥ è”åŠ¨ ============
    function updateNoiseLabel() {
      const v = Number(noiseSlider.value);
      const level = v === 0 ? "å…³é—­" : v <= 2 ? "è½»å¾®" : v <= 5 ? "ä¸­ç­‰" : "è¾ƒå¼º";
      noiseValueLabel.textContent = `${level} Â· ${v}`;
    }

    function updateQualityLabel() {
      const v = Number(qualitySlider.value);
      qualityValueLabel.textContent = `${v}%`;
    }

    function updateKeyPreview() {
      const keyRaw = keyInput.value.trim();
      if (!keyRaw) {
        keyHashPreview.textContent = "è‡ªåŠ¨éšæœº";
        state.currentKey = null;
        state.currentSeed = null;
        return;
      }
      const seed = stringToSeed(keyRaw);
      state.currentKey = keyRaw;
      state.currentSeed = seed;
      keyHashPreview.textContent = `å“ˆå¸Œç‰‡æ®µï¼š${shortHash(keyRaw)}`;
    }

    noiseSlider.addEventListener("input", () => {
      updateNoiseLabel();
    });

    qualitySlider.addEventListener("input", () => {
      updateQualityLabel();
    });

    keyInput.addEventListener("input", () => {
      updateKeyPreview();
    });

    // åˆå§‹åŒ–æ ‡ç­¾
    updateNoiseLabel();
    updateQualityLabel();
    updateKeyPreview();

    // ============ æ¨¡å¼åˆ‡æ¢ ============
    encryptModeBtn.addEventListener("click", () => {
      setMode("encrypt");
    });
    decryptModeBtn.addEventListener("click", () => {
      setMode("decrypt");
    });

    // ============ æ–‡ä»¶ä¸Šä¼ å¤„ç† ============
    fileInput.addEventListener("change", (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = () => {
        const img = new Image();
        img.onload = () => {
          state.originalImage = img;
          state.originalSize = file.size;
          inlineIndicator.innerHTML = `
            <span class="inline-indicator-dot"></span>
            å·²åŠ è½½å›¾ç‰‡ï¼š${formatBytes(file.size)}
          `;
          setStatus("å›¾ç‰‡åŠ è½½å®Œæˆï¼Œå¯é€‰æ‹©æ¨¡å¼å¹¶æ‰§è¡ŒåŠ å¯† / è§£å¯†ã€‚", "info");

          // ç»˜åˆ¶åˆ°åŸå›¾ canvas
          const { w, h } = resizeCanvasToImage(origCanvas, img);
          origCtx.drawImage(img, 0, 0, w, h);
          origPlaceholder.style.display = "none";
          origCanvas.classList.add("fade-in");
          setTimeout(() => origCanvas.classList.remove("fade-in"), 250);

          // æ¸…ç©ºåŠ å¯† / è§£å¯†é¢„è§ˆ
          drawPlaceholderClear(encryptedCanvas, encryptedPlaceholder, true);
          drawPlaceholderClear(decryptedCanvas, decryptedPlaceholder, true);
          state.encryptedImageData = null;
          state.decryptedImageData = null;
          state.encryptedSize = null;
          state.decryptedSize = null;
          exportEncryptedBtn.disabled = true;
          exportDecryptedBtn.disabled = true;

          updateMeta();
        };
        img.onerror = () => {
          setStatus("å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œè¯·æ›´æ¢æ–‡ä»¶é‡è¯•ã€‚", "error");
        };
        img.src = reader.result;
      };
      reader.readAsDataURL(file);
    });

    // æ”¯æŒæ‹–æ‹½ï¼ˆå¯é€‰å¢å¼ºï¼‰
    const uploadBubble = document.querySelector(".upload-bubble");
    ["dragenter", "dragover"].forEach((eventName) => {
      uploadBubble.addEventListener(eventName, (e) => {
        e.preventDefault();
        e.stopPropagation();
        uploadBubble.style.borderColor = "rgba(190, 242, 100, 0.95)";
      });
    });
    ["dragleave", "drop"].forEach((eventName) => {
      uploadBubble.addEventListener(eventName, (e) => {
        e.preventDefault();
        e.stopPropagation();
        uploadBubble.style.borderColor = "rgba(45, 212, 191, 0.8)";
      });
    });
    uploadBubble.addEventListener("drop", (e) => {
      const file = e.dataTransfer.files && e.dataTransfer.files[0];
      if (file) {
        fileInput.files = e.dataTransfer.files;
        const changeEvent = new Event("change");
        fileInput.dispatchEvent(changeEvent);
      }
    });

    // ============ æ ¸å¿ƒåƒç´ åŠ å¯†ç®—æ³• ============
    /**
     * è¿™é‡Œé‡‡ç”¨â€œå¯é€†åƒç´ æ‰°åŠ¨â€ï¼š
     * - å¯¹æ¯ä¸ªåƒç´ çš„ R/G/B çš„ä½å‡ ä½æ ¹æ®å¯†é’¥é©±åŠ¨çš„ä¼ªéšæœºæ•°åšå¯é€†æ“ä½œï¼›
     * - å¹¶å†™å…¥ä¸€ä¸ªç®€æ˜“å¤´æ ‡è®°ï¼ˆåœ¨å›¾åƒå·¦ä¸Šè§’å‡ åƒç´ å†…ï¼‰ï¼Œç”¨äºè¯†åˆ«â€œå·²ç»åŠ å¯†è¿‡â€ï¼›
     * - è§£å¯†æ—¶æ ¹æ®å¯†é’¥å’ŒåŒæ ·é€»è¾‘åå‘æ¢å¤ï¼›
     * - ä¸å†å‡ºç°â€œè¯†åˆ«ä¸å‡ºæ¥è¯´æ²¡æœ‰åŠ å¯†â€è¿™ç§æ¨¡ç³Šæç¤ºï¼šå¦‚æœå¯†é’¥é”™è¯¯ï¼Œå°±è§£ä¸å›åŸå›¾ï¼Œä½†ä»ç„¶ä¼šè¾“å‡ºç»“æœã€‚
     */
    const MAGIC = [137, 80, 78, 71, 13, 10, 26, 10]; // ä¸€æ®µ PNG å¤´å­—èŠ‚ï¼Œç”¨æ¥â€œä¼ªè£…â€æ ‡è®°

    function applyEncryptionToImageData(imageData, strength, seed) {
      const data = imageData.data;
      const len = data.length;
      const rand = seededRandom(seed);

      // è®°å½•åŸå§‹ä½ä½ï¼Œç”¨äºåå‘æ¢å¤æ—¶æ ¡éªŒï¼ˆå¯ä»¥è£å‰ª/æ‰©å±•ï¼‰
      // è¿™é‡Œç®€å•å®ç°ï¼šå¯¹ R/G/B ä½ 3 ä½åšå¼‚æˆ–æ‰°åŠ¨ï¼Œå¯é€†ã€‚
      const mask = (1 << Math.max(1, Math.min(3, strength))) - 1;

      // åœ¨å‰è‹¥å¹²åƒç´ å†™â€œé­”æ•° + é…ç½®ç‰‡æ®µâ€ï¼Œç”¨äºè°ƒè¯•å’Œè¯†åˆ«ã€‚
      const headerPixels = Math.min(8, len / 4);
      for (let i = 0; i < headerPixels; i++) {
        const base = i * 4;
        const flag = MAGIC[i];
        // ä¿ç•™ alpha ä¸å˜ï¼ŒæŠŠ R å†™æˆé­”æ•°çš„ä½ 8 ä½ï¼ŒG å†™ strengthï¼ŒB å†™ header index
        data[base] = flag;
        data[base + 1] = strength & 0xff;
        data[base + 2] = i;
      }

      for (let i = headerPixels * 4; i < len; i += 4) {
        // R,G,B åˆ†åˆ«åšæ‰°åŠ¨ï¼›A ä¿æŒä¸å˜
        for (let c = 0; c < 3; c++) {
          const idx = i + c;
          const orig = data[idx];
          const low = orig & mask;
          const r = Math.floor(rand() * (mask + 1)); // 0..mask
          const toggled = (orig & ~mask) | (low ^ r);
          data[idx] = toggled;
        }
      }
      return imageData;
    }

    function applyDecryptionToImageData(imageData, strength, seed) {
      // æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨å’ŒåŠ å¯†æ—¶åŒæ ·çš„ä¼ªéšæœºåºåˆ—ä¸æ“ä½œï¼Œå› ä¸ºæ˜¯ XORï¼Œå¯é€†ã€‚
      const data = imageData.data;
      const len = data.length;
      const rand = seededRandom(seed);
      const mask = (1 << Math.max(1, Math.min(3, strength))) - 1;

      const headerPixels = Math.min(8, len / 4);
      // ä¸æ¸…é™¤ headerï¼Œæ–¹ä¾¿è°ƒè¯•ï¼›å¦‚éœ€å¯ä»¥å»æ‰
      for (let i = headerPixels * 4; i < len; i += 4) {
        for (let c = 0; c < 3; c++) {
          const idx = i + c;
          const enc = data[idx];
          const low = enc & mask;
          const r = Math.floor(rand() * (mask + 1));
          const origLow = low ^ r;
          const restored = (enc & ~mask) | origLow;
          data[idx] = restored;
        }
      }
      return imageData;
    }

    // ============ æ‰§è¡ŒåŠ å¯† / è§£å¯† ============
    runEncryptBtn.addEventListener("click", () => {
      if (!state.originalImage) {
        setStatus("è¯·å…ˆä¸Šä¼ ä¸€å¼ å›¾ç‰‡ã€‚", "warn");
        setInlineIndicator("è¿˜æ²¡æœ‰å›¾ç‰‡ï¼Œè¯·å…ˆä¸Šä¼ ã€‚");
        return;
      }
      if (!state.mode) {
        setStatus("è¯·å…ˆé€‰æ‹©â€œåŠ å¯†â€æˆ–â€œè§£å¯†â€æ¨¡å¼ã€‚", "warn");
        return;
      }

      const strength = Number(noiseSlider.value);
      const quality = Number(qualitySlider.value) / 100;

      // å¦‚æœæœªæ‰‹åŠ¨å¡«å†™å¯†é’¥ï¼Œå°±è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå›ºå®šåœ¨æœ¬æ¬¡ä¼šè¯å†…çš„
      if (!state.currentSeed) {
        if (!state.currentKey) {
          state.currentKey = "AUTO-" + Math.random().toString(36).slice(2);
        }
        state.currentSeed = stringToSeed(state.currentKey);
        keyHashPreview.textContent = `è‡ªåŠ¨å¯†é’¥ï¼š${shortHash(state.currentKey)}`;
      }
      const seed = state.currentSeed;

      setInlineIndicator("å¤„ç†ä¸­â€¦ ä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚");
      setStatus(
        state.mode === "encrypt"
          ? "æ­£åœ¨æ‰§è¡ŒåŠ å¯†å¹¶ç”Ÿæˆé¢„è§ˆâ€¦"
          : "æ­£åœ¨å°è¯•è§£å¯†å½“å‰å›¾ç‰‡â€¦",
        "info"
      );

      // å°½é‡é¿å…å¡é¡¿ï¼šç”¨ requestAnimationFrame åŒ…ä¸€å±‚
      window.requestAnimationFrame(() => {
        const baseCanvas =
          state.mode === "encrypt" ? origCanvas : encryptedCanvas.width ? encryptedCanvas : origCanvas;

        const baseCtx =
          state.mode === "encrypt" ? origCtx : encryptedCanvas.width ? encCtx : origCtx;

        const w = baseCanvas.width;
        const h = baseCanvas.height;
        if (!w || !h) {
          setStatus("æ²¡æœ‰å¯å¤„ç†çš„åƒç´ æ•°æ®ï¼Œè¯·ç¡®è®¤é¢„è§ˆä¸­æœ‰å›¾ç‰‡ã€‚", "warn");
          return;
        }

        let imgData = baseCtx.getImageData(0, 0, w, h);

        if (state.mode === "encrypt") {
          imgData = applyEncryptionToImageData(imgData, strength, seed);
          encryptedCanvas.width = w;
          encryptedCanvas.height = h;
          encCtx.putImageData(imgData, 0, 0);
          state.encryptedImageData = imgData;
          encryptedPlaceholder.style.display = "none";
          encryptedCanvas.classList.add("fade-in");
          setTimeout(() => encryptedCanvas.classList.remove("fade-in"), 250);

          // åŒæ—¶åšä¸€æ¬¡â€œè§£å¯†é¢„æ¼”â€ï¼Œç”¨æ¥å±•ç¤ºâ€œç¡®è®¤å¯é€†â€ï¼Œä½†ä¸æ”¹å˜å¯†é’¥é€»è¾‘
          let previewDec = new ImageData(
            new Uint8ClampedArray(imgData.data),
            imgData.width,
            imgData.height
          );
          previewDec = applyDecryptionToImageData(previewDec, strength, seed);
          decryptedCanvas.width = w;
          decryptedCanvas.height = h;
          decCtx.putImageData(previewDec, 0, 0);
          state.decryptedImageData = previewDec;
          decryptedPlaceholder.style.display = "none";

          // å¯¼å‡ºå°ºå¯¸ä¼°ç®—
          const encDataUrl = encryptedCanvas.toDataURL("image/jpeg", quality);
          // ç²—ç•¥ä¼°ç®— byte é•¿åº¦
          const encBytes = Math.ceil((encDataUrl.length * 3) / 4);
          state.encryptedSize = encBytes;

          const decDataUrl = decryptedCanvas.toDataURL("image/jpeg", quality);
          const decBytes = Math.ceil((decDataUrl.length * 3) / 4);
          state.decryptedSize = decBytes;

          exportEncryptedBtn.disabled = false;
          exportDecryptedBtn.disabled = false;

          setInlineIndicator("åŠ å¯†å®Œæˆï¼Œå¯å¯¼å‡ºåŠ å¯†ä¸è§£å¯†ç»“æœã€‚");
          setStatus("åŠ å¯†å®Œæˆï¼Œå¦‚éœ€è¿˜åŸè¯·ç¡®ä¿ä½¿ç”¨åŒä¸€å¯†é’¥ä¸å‚æ•°ã€‚", "info");
        } else {
          // è§£å¯†æ¨¡å¼
          imgData = applyDecryptionToImageData(imgData, strength, seed);
          decryptedCanvas.width = w;
          decryptedCanvas.height = h;
          decCtx.putImageData(imgData, 0, 0);
          state.decryptedImageData = imgData;
          decryptedPlaceholder.style.display = "none";
          decryptedCanvas.classList.add("fade-in");
          setTimeout(() => decryptedCanvas.classList.remove("fade-in"), 250);

          const decDataUrl = decryptedCanvas.toDataURL("image/jpeg", quality);
          const decBytes = Math.ceil((decDataUrl.length * 3) / 4);
          state.decryptedSize = decBytes;

          exportDecryptedBtn.disabled = false;

          setInlineIndicator("è§£å¯†æ‰§è¡Œå®Œæˆï¼Œå¯æ¯”å¯¹åŸå›¾ä¸è§£å¯†ç»“æœã€‚");
          setStatus(
            "è§£å¯†æ‰§è¡Œå®Œæ¯•ã€‚å¦‚æœå¯†é’¥æˆ–å‚æ•°ä¸ä¸€è‡´ï¼Œå›¾åƒå¯èƒ½ä¸åŸå›¾æœ‰å·®å¼‚ï¼Œä½†ä¸ä¼šå‡ºç°â€œæœªåŠ å¯†â€çš„è¯¯åˆ¤æç¤ºã€‚",
            "info"
          );
        }

        updateMeta();
      });
    });

    // ============ å¯¼å‡ºæŒ‰é’® ============
    function downloadCanvas(canvas, filename, quality) {
      if (!canvas.width || !canvas.height) return;
      const link = document.createElement("a");
      link.download = filename;
      link.href = canvas.toDataURL("image/jpeg", quality);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    exportEncryptedBtn.addEventListener("click", () => {
      if (!state.encryptedImageData) return;
      const quality = Number(qualitySlider.value) / 100;
      const name = `encrypted_${shortHash(
        (state.currentKey || "") + Date.now().toString()
      )}.jpg`;
      downloadCanvas(encryptedCanvas, name, quality);
    });

    exportDecryptedBtn.addEventListener("click", () => {
      if (!state.decryptedImageData) return;
      const quality = Number(qualitySlider.value) / 100;
      const name = `decrypted_${shortHash(
        (state.currentKey || "") + Date.now().toString()
      )}.jpg`;
      downloadCanvas(decryptedCanvas, name, quality);
    });

    // ============ åˆå§‹çŠ¶æ€æ–‡æ¡ˆ ============
    setStatus("å‡†å¤‡å°±ç»ªï¼šå…ˆä¸Šä¼ å›¾ç‰‡ï¼Œå†é€‰æ‹©æ¨¡å¼å¹¶æ‰§è¡Œæ“ä½œã€‚", "info");
    setInlineIndicator("ç­‰å¾…å›¾ç‰‡ä¸Šä¼ â€¦");
  </script>
</body>
</html>
